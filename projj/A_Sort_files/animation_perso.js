var AnimationPerso = function()
{
    var uvs = {
        cam_body: {x:0,y:0,w:81,h:237},
        cam_bras_droit: {x:81,y:0,w:51,h:44},
        cam_bras_gauche: {x:132,y:0,w:51,h:44},
        cam_camera: {x:183,y:0,w:21,h:15},
        cam_epaule_droite: {x:204,y:0,w:47,h:26},
        cam_epaule_gauche: {x:0,y:237,w:49,h:24},
        jum_avb: {x:49,y:237,w:50,h:61},
        jum_body: {x:99,y:237,w:107,h:230},
        jum_epa: {x:206,y:237,w:40,h:32},
        size: {w:256,h:512},
    };

    var sizes = {
        jum_epa : [ 40,32 ],
        jum_avb : [ 50,61 ],
        jum_body : [ 107,230 ],

        cam_body : [ 81,237 ],
        cam_epaule_gauche : [ 49,24 ],
        cam_epaule_droite : [ 47,26 ],
        cam_bras_droit : [ 51,44 ],
        cam_bras_gauche : [ 51,44 ],
        cam_camera : [ 21,15 ],
    };

    var frames = {
        jum_epa : [ 0.9999847412109375,-0.0010528564453125,0.0010528564453125,0.9999847412109375,322.7,168.35,0.999969482421875,-0.00537109375,0.00537109375,0.999969482421875,322.45,168.3,0.999908447265625,-0.0096893310546875,0.0096893310546875,0.999908447265625,322.25,168.2,0.999847412109375,-0.014007568359375,0.014007568359375,0.999847412109375,322,168.2,0.9997711181640625,-0.0183258056640625,0.0183258056640625,0.9997711181640625,321.85,168.15,0.999664306640625,-0.02264404296875,0.02264404296875,0.999664306640625,321.55,168.05,0.999542236328125,-0.0269622802734375,0.0269622802734375,0.999542236328125,321.4,168,0.9994049072265625,-0.031280517578125,0.031280517578125,0.9994049072265625,321.15,167.95,0.999237060546875,-0.0355987548828125,0.0355987548828125,0.999237060546875,320.95,167.9,0.9990692138671875,-0.0399169921875,0.0399169921875,0.9990692138671875,320.7,167.85,0.998870849609375,-0.0442352294921875,0.0442352294921875,0.998870849609375,320.55,167.75,0.9986572265625,-0.0485382080078125,0.0485382080078125,0.9986572265625,320.3,167.75,0.9984283447265625,-0.0528564453125,0.0528564453125,0.9984283447265625,320.1,167.7,0.9981689453125,-0.057220458984375,0.057220458984375,0.9981689453125,319.85,167.65,0.997894287109375,-0.0615234375,0.0615234375,0.997894287109375,319.55,167.6,0.9976043701171875,-0.0658416748046875,0.0658416748046875,0.9976043701171875,319.4,167.55,0.9972991943359375,-0.0701446533203125,0.0701446533203125,0.9972991943359375,319.2,167.5,0.996978759765625,-0.074462890625,0.074462890625,0.996978759765625,318.95,167.45,0.9966278076171875,-0.078765869140625,0.078765869140625,0.9966278076171875,318.7,167.35,0.9962615966796875,-0.08306884765625,0.08306884765625,0.9962615966796875,318.6,167.35,0.995880126953125,-0.087371826171875,0.087371826171875,0.995880126953125,318.3,167.25,0.9954833984375,-0.0916748046875,0.0916748046875,0.9954833984375,318.15,167.25,0.99505615234375,-0.095977783203125,0.095977783203125,0.99505615234375,317.9,167.1,0.99462890625,-0.10028076171875,0.10028076171875,0.99462890625,317.7,167.15,0.994171142578125,-0.1045684814453125,0.1045684814453125,0.994171142578125,317.45,167.1,0.994049072265625,-0.1088714599609375,0.1088714599609375,0.994049072265625,317.3,167.05,0.9935760498046875,-0.1132049560546875,0.1132049560546875,0.9935760498046875,317,166.95,0.993072509765625,-0.1142425537109375,0.1142425537109375,0.993072509765625,316.9,166.85,0.9925537109375,-0.1185302734375,0.1185302734375,0.9925537109375,316.65,166.8,0.9920196533203125,-0.1228179931640625,0.1228179931640625,0.9920196533203125,316.45,166.7,0.9914703369140625,-0.127105712890625,0.127105712890625,0.9914703369140625,316.2,166.7,0.9908905029296875,-0.1313934326171875,0.1313934326171875,0.9908905029296875,316,166.7,0.9903106689453125,-0.1356658935546875,0.1356658935546875,0.9903106689453125,315.8,166.6,0.9897003173828125,-0.13995361328125,0.13995361328125,0.9897003173828125,315.65,166.55,0.9890594482421875,-0.14422607421875,0.14422607421875,0.9890594482421875,315.4,166.5,0.9884185791015625,-0.14849853515625,0.14849853515625,0.9884185791015625,315.15,166.45,0.987762451171875,-0.15277099609375,0.15277099609375,0.987762451171875,315,166.45,0.9870758056640625,-0.15704345703125,0.15704345703125,0.9870758056640625,314.85,166.35,0.9863739013671875,-0.1613006591796875,0.1613006591796875,0.9863739013671875,314.55,166.3,0.98565673828125,-0.165557861328125,0.165557861328125,0.98565673828125,314.35,166.3,0.9849090576171875,-0.16986083984375,0.16986083984375,0.9849090576171875,314.1,166.25,0.9841461181640625,-0.1741180419921875,0.1741180419921875,0.9841461181640625,314,166.2,0.983367919921875,-0.178375244140625,0.178375244140625,0.983367919921875,313.75,166.1,0.982574462890625,-0.1826171875,0.1826171875,0.982574462890625,313.45,166.05,0.9817657470703125,-0.1868743896484375,0.1868743896484375,0.9817657470703125,313.35,166,0.9809417724609375,-0.19110107421875,0.19110107421875,0.9809417724609375,313.15,165.95,0.9800872802734375,-0.195343017578125,0.195343017578125,0.9800872802734375,312.9,165.95,0.979217529296875,-0.1995849609375,0.1995849609375,0.979217529296875,312.75,165.95,0.97833251953125,-0.2038116455078125,0.2038116455078125,0.97833251953125,312.55,165.9,0.9774322509765625,-0.208038330078125,0.208038330078125,0.9774322509765625,312.35,165.85,0.9765167236328125,-0.2122650146484375,0.2122650146484375,0.9765167236328125,312.1,165.8,0.9755706787109375,-0.2164764404296875,0.2164764404296875,0.9755706787109375,311.9,165.7,0.975341796875,-0.220703125,0.220703125,0.975341796875,311.75,165.65,0.974365234375,-0.224945068359375,0.224945068359375,0.974365234375,311.45,165.65 ],
        jum_avb : [ 0.999542236328125,0.0269622802734375,-0.0269622802734375,0.999542236328125,320.1,191.8,0.9981689453125,0.057220458984375,-0.057220458984375,0.9981689453125,320.1,190.35,0.995880126953125,0.087371826171875,-0.087371826171875,0.995880126953125,320.15,189,0.993072509765625,0.1142425537109375,-0.1142425537109375,0.993072509765625,320.1,187.75,0.9890594482421875,0.14422607421875,-0.14422607421875,0.9890594482421875,320.15,186.45,0.9841461181640625,0.1741180419921875,-0.1741180419921875,0.9841461181640625,320.2,185.15,0.97833251953125,0.2038116455078125,-0.2038116455078125,0.97833251953125,320.25,183.85,0.9723968505859375,0.2301788330078125,-0.2301788330078125,0.9723968505859375,320.25,182.7,0.9648895263671875,0.259490966796875,-0.259490966796875,0.9648895263671875,320.35,181.5,0.9564971923828125,0.2886199951171875,-0.2886199951171875,0.9564971923828125,320.85,180.05,0.947235107421875,0.3174285888671875,-0.3174285888671875,0.947235107421875,321.45,178.6,0.938232421875,0.342926025390625,-0.342926025390625,0.938232421875,321.85,177.2,0.9273529052734375,0.3711700439453125,-0.3711700439453125,0.9273529052734375,322.45,175.8,0.91558837890625,0.39910888671875,-0.39910888671875,0.91558837890625,323,174.5,0.90301513671875,0.4266510009765625,-0.4266510009765625,0.90301513671875,323.55,173.15,0.891082763671875,0.4509124755859375,-0.4509124755859375,0.891082763671875,323.95,171.95,0.876953125,0.477691650390625,-0.477691650390625,0.876953125,324.6,170.7,0.86199951171875,0.5040740966796875,-0.5040740966796875,0.86199951171875,325.15,169.5,0.846282958984375,0.5299530029296875,-0.5299530029296875,0.846282958984375,325.75,168.3,0.8315887451171875,0.5526580810546875,-0.5526580810546875,0.8315887451171875,326.2,167.15,0.814422607421875,0.577606201171875,-0.577606201171875,0.814422607421875,326.85,166.05,0.796478271484375,0.6020660400390625,-0.6020660400390625,0.796478271484375,327.45,165,0.7798919677734375,0.6259307861328125,-0.6259307861328125,0.7798919677734375,328,163.9,0.7605743408203125,0.646759033203125,-0.646759033203125,0.7605743408203125,328.55,163,0.737548828125,0.672882080078125,-0.672882080078125,0.737548828125,329.6,161.7,0.713623046875,0.6981964111328125,-0.6981964111328125,0.713623046875,330.75,160.5,0.6888275146484375,0.7226715087890625,-0.7226715087890625,0.6888275146484375,331.85,159.35,0.6632080078125,0.7462615966796875,-0.7462615966796875,0.6632080078125,332.9,158.15,0.63677978515625,0.768951416015625,-0.768951416015625,0.63677978515625,334.05,157.05,0.609588623046875,0.79071044921875,-0.79071044921875,0.609588623046875,335.1,156.1,0.584320068359375,0.809600830078125,-0.809600830078125,0.584320068359375,336.05,155.1,0.555755615234375,0.82952880859375,-0.82952880859375,0.555755615234375,337.1,154.1,0.5265045166015625,0.8484344482421875,-0.8484344482421875,0.5265045166015625,338.15,153.15,0.4966278076171875,0.8663330078125,-0.8663330078125,0.4966278076171875,339.1,152.35,0.466156005859375,0.8831787109375,-0.8831787109375,0.466156005859375,340.2,151.55,0.43511962890625,0.8989410400390625,-0.8989410400390625,0.43511962890625,341.2,150.75,0.4035491943359375,0.91363525390625,-0.91363525390625,0.4035491943359375,342.15,150.05,0.371490478515625,0.927215576171875,-0.927215576171875,0.371490478515625,343.1,149.45,0.3420257568359375,0.939697265625,-0.939697265625,0.3420257568359375,343.95,148.6,0.317474365234375,0.9472198486328125,-0.9472198486328125,0.317474365234375,344.95,148.2,0.29266357421875,0.9552459716796875,-0.9552459716796875,0.29266357421875,346,147.8,0.2676544189453125,0.9626312255859375,-0.9626312255859375,0.2676544189453125,347,147.5,0.2425079345703125,0.9693450927734375,-0.9693450927734375,0.2425079345703125,348.05,147.15,0.2171630859375,0.9754180908203125,-0.9754180908203125,0.2171630859375,349.1,146.8,0.1916656494140625,0.9808349609375,-0.9808349609375,0.1916656494140625,350,146.4,0.16607666015625,0.985565185546875,-0.985565185546875,0.16607666015625,351,146.15,0.143585205078125,0.989166259765625,-0.989166259765625,0.143585205078125,351.9,145.85,0.1177520751953125,0.992645263671875,-0.992645263671875,0.1177520751953125,352.75,145.55,0.091888427734375,0.9954681396484375,-0.9954681396484375,0.091888427734375,353.75,145.25,0.06591796875,0.9976043701171875,-0.9976043701171875,0.06591796875,354.55,145.1,0.0399169921875,0.9990692138671875,-0.9990692138671875,0.0399169921875,355.5,144.8,0.013916015625,0.999847412109375,-0.999847412109375,0.013916015625,356.3,144.7,-0.00885009765625,0.9999237060546875,-0.9999237060546875,-0.00885009765625,357.05,144.5,-0.0348968505859375,0.9993896484375,-0.9993896484375,-0.0348968505859375,357.85,144.2 ],
        jum_body : [ 1,0,0,1,241.8,132.4],

        cam_bras_gauche : [ 0.200103759765625,0.9791107177734375,-0.9791107177734375,0.200103759765625,287.45,180.8,0.229583740234375,0.9725341796875,-0.9725341796875,0.229583740234375,286.9,179.75,0.258880615234375,0.9650726318359375,-0.9650726318359375,0.258880615234375,286.2,178.65,0.28472900390625,0.957672119140625,-0.957672119140625,0.28472900390625,285.5,177.6,0.3135528564453125,0.94854736328125,-0.94854736328125,0.3135528564453125,284.85,176.55,0.3420562744140625,0.9385528564453125,-0.9385528564453125,0.3420562744140625,284.2,175.5,0.3672027587890625,0.9289398193359375,-0.9289398193359375,0.3672027587890625,283.6,174.45,0.3951263427734375,0.917327880859375,-0.917327880859375,0.3951263427734375,283,173.35,0.42266845703125,0.9048919677734375,-0.9048919677734375,0.42266845703125,282.35,172.25,0.4468841552734375,0.893157958984375,-0.893157958984375,0.4468841552734375,281.7,171.2,0.4736785888671875,0.8791351318359375,-0.8791351318359375,0.4736785888671875,281,170.2,0.500030517578125,0.864349365234375,-0.864349365234375,0.500030517578125,280.35,169.1,0.52313232421875,0.8505401611328125,-0.8505401611328125,0.52313232421875,279.7,168.05,0.548614501953125,0.834259033203125,-0.834259033203125,0.548614501953125,279.1,167,0.5736236572265625,0.8172454833984375,-0.8172454833984375,0.5736236572265625,278.45,165.9,0.595428466796875,0.8014678955078125,-0.8014678955078125,0.595428466796875,277.8,164.9,0.619415283203125,0.783050537109375,-0.783050537109375,0.619415283203125,277.15,163.8,0.642822265625,0.7639007568359375,-0.7639007568359375,0.642822265625,276.5,162.75,0.6631927490234375,0.7462921142578125,-0.7462921142578125,0.6631927490234375,275.85,161.65,0.68548583984375,0.7258453369140625,-0.7258453369140625,0.68548583984375,275.2,160.6,0.7071380615234375,0.70477294921875,-0.70477294921875,0.7071380615234375,274.55,159.55,0.72589111328125,0.6854400634765625,-0.6854400634765625,0.72589111328125,273.85,158.5,0.7463226318359375,0.66314697265625,-0.66314697265625,0.7463226318359375,273.3,157.4,0.76605224609375,0.6427764892578125,-0.6427764892578125,0.76605224609375,272.55,156.35,0.780487060546875,0.62261962890625,-0.62261962890625,0.780487060546875,271.7,155.85,0.7965240478515625,0.6020050048828125,-0.6020050048828125,0.7965240478515625,270.7,155.35,0.8119659423828125,0.5810546875,-0.5810546875,0.8119659423828125,269.85,154.75,0.826904296875,0.5596466064453125,-0.5596466064453125,0.826904296875,268.85,154.25,0.8412628173828125,0.537872314453125,-0.537872314453125,0.8412628173828125,267.85,153.65,0.8550262451171875,0.5157623291015625,-0.5157623291015625,0.8550262451171875,266.95,153.2,0.868255615234375,0.4933013916015625,-0.4933013916015625,0.868255615234375,265.95,152.65,0.87933349609375,0.4733428955078125,-0.4733428955078125,0.87933349609375,265.1,152.15,0.89141845703125,0.450286865234375,-0.450286865234375,0.89141845703125,264.1,151.6,0.902923583984375,0.4268798828125,-0.4268798828125,0.902923583984375,263.15,151.05,0.9138031005859375,0.4031829833984375,-0.4031829833984375,0.9138031005859375,262.2,150.55,0.9240570068359375,0.3792572021484375,-0.3792572021484375,0.9240570068359375,261.15,150,0.933685302734375,0.355010986328125,-0.355010986328125,0.933685302734375,260.3,149.5,0.9427032470703125,0.330535888671875,-0.330535888671875,0.9427032470703125,259.35,148.95,0.9510498046875,0.30902099609375,-0.30902099609375,0.9510498046875,258.45,148.45,0.957855224609375,0.2841339111328125,-0.2841339111328125,0.957855224609375,257.4,148.15,0.9650115966796875,0.259063720703125,-0.259063720703125,0.9650115966796875,256.4,147.95,0.97149658203125,0.233856201171875,-0.233856201171875,0.97149658203125,255.55,147.7,0.9773712158203125,0.208465576171875,-0.208465576171875,0.9773712158203125,254.5,147.5,0.9825439453125,0.1829071044921875,-0.1829071044921875,0.9825439453125,253.5,147.2,0.9870452880859375,0.157257080078125,-0.157257080078125,0.9870452880859375,252.5,147,0.990875244140625,0.1315155029296875,-0.1315155029296875,0.990875244140625,251.55,146.75,0.993682861328125,0.1089019775390625,-0.1089019775390625,0.993682861328125,250.6,146.45,0.99627685546875,0.0830078125,-0.0830078125,0.99627685546875,249.55,146.25,0.9981842041015625,0.0570220947265625,-0.0570220947265625,0.9981842041015625,248.55,146,0.999420166015625,0.031005859375,-0.031005859375,0.999420166015625,247.65,145.75,0.999969482421875,0.0049591064453125,-0.0049591064453125,0.999969482421875,246.6,145.5,0.9997711181640625,-0.0177459716796875,0.0177459716796875,0.9997711181640625,245.65,145.25,0.998870849609375,-0.04376220703125,0.04376220703125,0.998870849609375,244.65,145,0.99755859375,-0.0697784423828125,0.0697784423828125,0.99755859375,243.65,144.75 ],
        cam_camera : [ 1,0,0,1,289.9,214.3,1,0,0,1,289.85,212.9,1,0,0,1,289.8,211.5,1,0,0,1,289.75,210.1,1,0,0,1,289.7,208.7,1,0,0,1,289.65,207.3,1,0,0,1,289.55,205.9,1,0,0,1,289.5,204.5,1,0,0,1,289.45,203.1,1,0,0,1,289.4,201.7,1,0,0,1,289.35,200.3,1,0,0,1,289.3,198.9,1,0,0,1,289.25,197.5,1,0,0,1,289.15,196.05,1,0,0,1,289.1,194.65,1,0,0,1,289.05,193.25,1,0,0,1,289,191.85,1,0,0,1,288.95,190.45,1,0,0,1,288.9,189.05,1,0,0,1,288.85,187.65,1,0,0,1,288.75,186.25,1,0,0,1,288.7,184.85,1,0,0,1,288.65,183.45,1,0,0,1,288.6,182.05,1,0,0,1,288.55,180.65,1,0,0,1,288.5,179.25,1,0,0,1,288.4,177.8,1,0,0,1,288.35,176.4,1,0,0,1,288.3,175,1,0,0,1,288.25,173.6,1,0,0,1,288.2,172.2,1,0,0,1,288.15,170.8,1,0,0,1,288.1,169.4,1,0,0,1,288,168,1,0,0,1,287.95,166.6,1,0,0,1,287.9,165.2,1,0,0,1,287.85,163.8,1,0,0,1,287.8,162.4,1,0,0,1,287.75,161,1,0,0,1,287.7,159.6,1,0,0,1,287.6,158.15,1,0,0,1,287.55,156.75,1,0,0,1,287.5,155.35,1,0,0,1,287.45,153.95,1,0,0,1,287.4,152.55,1,0,0,1,287.35,151.15,1,0,0,1,287.3,149.75,1,0,0,1,287.2,148.35,1,0,0,1,287.15,146.95,1,0,0,1,287.1,145.55,1,0,0,1,287.05,144.15,1,0,0,1,287,142.75,1,0,0,1,286.95,141.35,1,0,0,1,286.85,139.9 ],
        cam_bras_droit : [ 0.1181182861328125,-0.99261474609375,0.99261474609375,0.1181182861328125,303.15,232.75,0.15216064453125,-0.9878692626953125,0.9878692626953125,0.15216064453125,302.35,230.95,0.1828155517578125,-0.9825439453125,0.9825439453125,0.1828155517578125,301.45,229.1,0.21649169921875,-0.9755859375,0.9755859375,0.21649169921875,300.45,227.3,0.2467041015625,-0.968292236328125,0.968292236328125,0.2467041015625,299.55,225.45,0.2798919677734375,-0.9591064453125,0.9591064453125,0.2798919677734375,298.65,223.65,0.3095703125,-0.9498748779296875,0.9498748779296875,0.3095703125,297.8,221.85,0.3420562744140625,-0.9385528564453125,0.9385528564453125,0.3420562744140625,296.85,220,0.3710784912109375,-0.927398681640625,0.927398681640625,0.3710784912109375,296.05,218.15,0.402801513671875,-0.9139862060546875,0.9139862060546875,0.402801513671875,295.05,216.35,0.4310302734375,-0.90093994140625,0.90093994140625,0.4310302734375,294.2,214.55,0.4617919921875,-0.8854827880859375,0.8854827880859375,0.4617919921875,293.35,212.75,0.4891357421875,-0.8706207275390625,0.8706207275390625,0.4891357421875,292.4,210.9,0.5188140869140625,-0.8531951904296875,0.8531951904296875,0.5188140869140625,291.45,209.1,0.5451202392578125,-0.8365936279296875,0.8365936279296875,0.5451202392578125,291.15,206.9,0.5736083984375,-0.8172454833984375,0.8172454833984375,0.5736083984375,290.75,204.65,0.5988006591796875,-0.7989501953125,0.7989501953125,0.5988006591796875,290.35,202.55,0.6259765625,-0.777801513671875,0.777801513671875,0.6259765625,289.95,200.35,0.649871826171875,-0.757904052734375,0.757904052734375,0.649871826171875,289.6,198.1,0.6756439208984375,-0.7350311279296875,0.7350311279296875,0.6756439208984375,289.3,195.9,0.698211669921875,-0.713623046875,0.713623046875,0.698211669921875,288.8,193.8,0.722412109375,-0.6891326904296875,0.6891326904296875,0.722412109375,288.45,191.55,0.7435302734375,-0.666290283203125,0.666290283203125,0.7435302734375,288.05,189.4,0.76605224609375,-0.642791748046875,0.642791748046875,0.76605224609375,287.65,187.15,0.7801361083984375,-0.6230621337890625,0.6230621337890625,0.7801361083984375,288.1,185.75,0.7938079833984375,-0.6055755615234375,0.6055755615234375,0.7938079833984375,288.5,184.3,0.8090362548828125,-0.5877838134765625,0.5877838134765625,0.8090362548828125,288.85,182.9,0.8218841552734375,-0.5669708251953125,0.5669708251953125,0.8218841552734375,289.2,181.45,0.83428955078125,-0.5485687255859375,0.5485687255859375,0.83428955078125,289.55,180.1,0.8480682373046875,-0.529937744140625,0.529937744140625,0.8480682373046875,289.95,178.6,0.859588623046875,-0.5081329345703125,0.5081329345703125,0.859588623046875,290.4,177.1,0.8707275390625,-0.488922119140625,0.488922119140625,0.8707275390625,290.7,175.75,0.882965087890625,-0.469482421875,0.469482421875,0.882965087890625,291.15,174.3,0.8931732177734375,-0.4468231201171875,0.4468231201171875,0.8931732177734375,291.45,172.8,0.9029083251953125,-0.4268798828125,0.4268798828125,0.9029083251953125,291.85,171.45,0.9135589599609375,-0.40673828125,0.40673828125,0.9135589599609375,292.3,169.95,0.92236328125,-0.383331298828125,0.383331298828125,0.92236328125,292.6,168.5,0.9307098388671875,-0.362762451171875,0.362762451171875,0.9307098388671875,293.05,167.15,0.939697265625,-0.3420257568359375,0.3420257568359375,0.939697265625,293.35,165.7,0.9470672607421875,-0.317962646484375,0.317962646484375,0.9470672607421875,294.1,164.2,0.9539337158203125,-0.296875,0.296875,0.9539337158203125,294.7,162.85,0.961273193359375,-0.2756195068359375,0.2756195068359375,0.961273193359375,295.3,161.5,0.9671630859375,-0.25103759765625,0.25103759765625,0.9671630859375,296,159.95,0.9725494384765625,-0.2295379638671875,0.2295379638671875,0.9725494384765625,296.7,158.6,0.9781646728515625,-0.207916259765625,0.207916259765625,0.9781646728515625,297.3,157.1,0.9825439453125,-0.18292236328125,0.18292236328125,0.9825439453125,297.95,155.75,0.9864044189453125,-0.1610870361328125,0.1610870361328125,0.9864044189453125,298.65,154.3,0.990264892578125,-0.1391754150390625,0.1391754150390625,0.990264892578125,299.35,152.9,0.993133544921875,-0.1138916015625,0.1138916015625,0.993133544921875,299.9,151.55,0.9954681396484375,-0.0918426513671875,0.0918426513671875,0.9954681396484375,300.6,150,0.9975738525390625,-0.06976318359375,0.06976318359375,0.9975738525390625,301.25,148.65,0.998870849609375,-0.0443267822265625,0.0443267822265625,0.998870849609375,301.85,147.15,0.99969482421875,-0.0221710205078125,0.0221710205078125,0.99969482421875,302.6,145.8,1.0000152587890625,0,0,1.0000152587890625,303.2,144.35 ],
        cam_epaule_gauche : [ 0.9625244140625,-0.268096923828125,0.268096923828125,0.9625244140625,242.65,174.5,0.9637451171875,-0.2636566162109375,0.2636566162109375,0.9637451171875,242.75,174.3,0.9649505615234375,-0.2592926025390625,0.2592926025390625,0.9649505615234375,242.85,174.05,0.9661407470703125,-0.2548675537109375,0.2548675537109375,0.9661407470703125,242.95,173.95,0.9673309326171875,-0.2504425048828125,0.2504425048828125,0.9673309326171875,243.05,173.65,0.9692840576171875,-0.2428741455078125,0.2428741455078125,0.9692840576171875,243.15,173.5,0.9703826904296875,-0.2384185791015625,0.2384185791015625,0.9703826904296875,243.25,173.35,0.9714813232421875,-0.2339630126953125,0.2339630126953125,0.9714813232421875,243.35,173.1,0.9725494384765625,-0.2295379638671875,0.2295379638671875,0.9725494384765625,243.4,172.9,0.9736175537109375,-0.2250823974609375,0.2250823974609375,0.9736175537109375,243.5,172.7,0.9753570556640625,-0.2174835205078125,0.2174835205078125,0.9753570556640625,243.65,172.5,0.976348876953125,-0.2129974365234375,0.2129974365234375,0.976348876953125,243.75,172.3,0.977325439453125,-0.208526611328125,0.208526611328125,0.977325439453125,243.8,172.05,0.978302001953125,-0.204071044921875,0.204071044921875,0.978302001953125,243.95,171.95,0.9792327880859375,-0.1995849609375,0.1995849609375,0.9792327880859375,244,171.65,0.980804443359375,-0.195098876953125,0.195098876953125,0.980804443359375,244.1,171.5,0.9816741943359375,-0.18743896484375,0.18743896484375,0.9816741943359375,244.25,171.3,0.9825439453125,-0.18292236328125,0.18292236328125,0.9825439453125,244.3,171.05,0.9833526611328125,-0.1784820556640625,0.1784820556640625,0.9833526611328125,244.4,170.9,0.9841766357421875,-0.1739501953125,0.1739501953125,0.9841766357421875,244.5,170.65,0.9849700927734375,-0.16943359375,0.16943359375,0.9849700927734375,244.55,170.5,0.9863128662109375,-0.1617431640625,0.1617431640625,0.9863128662109375,244.65,170.25,0.987060546875,-0.1572113037109375,0.1572113037109375,0.987060546875,244.75,170.1,0.9877777099609375,-0.1526947021484375,0.1526947021484375,0.9877777099609375,244.85,169.9,0.9884796142578125,-0.148193359375,0.148193359375,0.9884796142578125,244.9,169.65,0.9891510009765625,-0.1436767578125,0.1436767578125,0.9891510009765625,245.05,169.5,0.99029541015625,-0.1359100341796875,0.1359100341796875,0.99029541015625,245.15,169.25,0.9908905029296875,-0.13140869140625,0.13140869140625,0.9908905029296875,245.2,169.15,0.99151611328125,-0.126861572265625,0.126861572265625,0.99151611328125,245.3,168.9,0.9920806884765625,-0.1223602294921875,0.1223602294921875,0.9920806884765625,245.4,168.7,0.992645263671875,-0.1178131103515625,0.1178131103515625,0.992645263671875,245.5,168.45,0.993194580078125,-0.1132659912109375,0.1132659912109375,0.993194580078125,245.55,168.3,0.9940643310546875,-0.105499267578125,0.105499267578125,0.9940643310546875,245.7,168.05,0.9945526123046875,-0.100921630859375,0.100921630859375,0.9945526123046875,245.75,167.85,0.995025634765625,-0.09637451171875,0.09637451171875,0.995025634765625,245.85,167.65,0.9954833984375,-0.09185791015625,0.09185791015625,0.9954833984375,246,167.5,0.99591064453125,-0.0872802734375,0.0872802734375,0.99591064453125,246.05,167.3,0.9965667724609375,-0.0795135498046875,0.0795135498046875,0.9965667724609375,246.1,167.1,0.9969329833984375,-0.0749359130859375,0.0749359130859375,0.9969329833984375,246.25,166.9,0.9972991943359375,-0.07037353515625,0.07037353515625,0.9972991943359375,246.35,166.7,0.99761962890625,-0.06585693359375,0.06585693359375,0.99761962890625,246.4,166.45,0.9979248046875,-0.0612640380859375,0.0612640380859375,0.9979248046875,246.6,166.3,0.9984130859375,-0.05670166015625,0.05670166015625,0.9984130859375,246.65,166.1,0.9986572265625,-0.04888916015625,0.04888916015625,0.9986572265625,246.75,165.9,0.9988861083984375,-0.0443115234375,0.0443115234375,0.9988861083984375,246.85,165.7,0.9990692138671875,-0.039794921875,0.039794921875,0.9990692138671875,246.85,165.45,0.999267578125,-0.0352020263671875,0.0352020263671875,0.999267578125,247,165.35,0.999420166015625,-0.0306243896484375,0.0306243896484375,0.999420166015625,247.05,165.1,0.9996795654296875,-0.0228271484375,0.0228271484375,0.9996795654296875,247.2,164.95,0.999786376953125,-0.01824951171875,0.01824951171875,0.999786376953125,247.3,164.7,0.9998626708984375,-0.0136566162109375,0.0136566162109375,0.9998626708984375,247.45,164.5,0.9999237060546875,-0.009124755859375,0.009124755859375,0.9999237060546875,247.5,164.25,0.999969482421875,-0.004547119140625,0.004547119140625,0.999969482421875,247.6,164.1,1.0000152587890625,0,0,1.0000152587890625,247.7,163.9 ],
        cam_epaule_droite : [ 0.990386962890625,0.13494873046875,-0.13494873046875,0.990386962890625,306,162.7,0.990966796875,0.1307373046875,-0.1307373046875,0.990966796875,305.9,162.7,0.9915313720703125,0.12652587890625,-0.12652587890625,0.9915313720703125,305.85,162.7,0.9920654296875,0.122344970703125,-0.122344970703125,0.9920654296875,305.85,162.75,0.9925994873046875,0.11810302734375,-0.11810302734375,0.9925994873046875,305.75,162.8,0.99310302734375,0.1138916015625,-0.1138916015625,0.99310302734375,305.75,162.8,0.993621826171875,0.1096954345703125,-0.1096954345703125,0.993621826171875,305.65,162.85,0.9940643310546875,0.105499267578125,-0.105499267578125,0.9940643310546875,305.6,162.95,0.9944915771484375,0.1045074462890625,-0.1045074462890625,0.9944915771484375,305.6,162.95,0.99462890625,0.10028076171875,-0.10028076171875,0.99462890625,305.5,163,0.9950408935546875,0.0960693359375,-0.0960693359375,0.9950408935546875,305.45,163.05,0.9954681396484375,0.091827392578125,-0.091827392578125,0.9954681396484375,305.45,163.05,0.9958648681640625,0.0876312255859375,-0.0876312255859375,0.9958648681640625,305.4,163.1,0.9962310791015625,0.0833740234375,-0.0833740234375,0.9962310791015625,305.3,163.15,0.99658203125,0.0791473388671875,-0.0791473388671875,0.99658203125,305.25,163.2,0.996917724609375,0.0749359130859375,-0.0749359130859375,0.996917724609375,305.25,163.15,0.99725341796875,0.070709228515625,-0.070709228515625,0.99725341796875,305.2,163.25,0.99755859375,0.06976318359375,-0.06976318359375,0.99755859375,305.1,163.3,0.9976348876953125,0.06549072265625,-0.06549072265625,0.9976348876953125,305.05,163.25,0.997894287109375,0.0612640380859375,-0.0612640380859375,0.997894287109375,305,163.3,0.9981689453125,0.0570526123046875,-0.0570526123046875,0.9981689453125,304.95,163.4,0.998443603515625,0.05279541015625,-0.05279541015625,0.998443603515625,304.9,163.4,0.9986572265625,0.0485382080078125,-0.0485382080078125,0.9986572265625,304.9,163.45,0.998870849609375,0.0443115234375,-0.0443115234375,0.998870849609375,304.75,163.45,0.999053955078125,0.0400848388671875,-0.0400848388671875,0.999053955078125,304.75,163.45,0.999237060546875,0.035858154296875,-0.035858154296875,0.999237060546875,304.7,163.5,0.9993743896484375,0.034912109375,-0.034912109375,0.9993743896484375,304.65,163.55,0.9994049072265625,0.030609130859375,-0.030609130859375,0.9994049072265625,304.65,163.55,0.999542236328125,0.026397705078125,-0.026397705078125,0.999542236328125,304.6,163.65,0.999664306640625,0.0221710205078125,-0.0221710205078125,0.999664306640625,304.5,163.7,0.9997711181640625,0.0179290771484375,-0.0179290771484375,0.9997711181640625,304.4,163.7,0.9998626708984375,0.013641357421875,-0.013641357421875,0.9998626708984375,304.4,163.7,0.999908447265625,0.009429931640625,-0.009429931640625,0.999908447265625,304.3,163.75,0.999969482421875,0.00518798828125,-0.00518798828125,0.999969482421875,304.3,163.8,0.9999847412109375,0.000946044921875,-0.000946044921875,0.9999847412109375,304.25,163.85,0.9999847412109375,0,0,0.9999847412109375,304.2,163.85,0.999969482421875,-0.0009613037109375,0.0009613037109375,0.999969482421875,304.15,163.85,0.999969482421875,-0.0052032470703125,0.0052032470703125,0.999969482421875,304.1,163.95,0.999908447265625,-0.0094146728515625,0.0094146728515625,0.999908447265625,304.05,163.95,0.9998626708984375,-0.0136566162109375,0.0136566162109375,0.9998626708984375,304.05,164,0.999755859375,-0.0179443359375,0.0179443359375,0.999755859375,303.95,164.05,0.999664306640625,-0.0221710205078125,0.0221710205078125,0.999664306640625,303.9,164.05,0.999542236328125,-0.026397705078125,0.026397705078125,0.999542236328125,303.85,164.1,0.9994049072265625,-0.0306243896484375,0.0306243896484375,0.9994049072265625,303.8,164.1,0.9993743896484375,-0.0315704345703125,0.0315704345703125,0.9993743896484375,303.75,164.15,0.9992218017578125,-0.035858154296875,0.035858154296875,0.9992218017578125,303.7,164.25,0.9990386962890625,-0.040069580078125,0.040069580078125,0.9990386962890625,303.65,164.2,0.998870849609375,-0.0443115234375,0.0443115234375,0.998870849609375,303.6,164.3,0.9986419677734375,-0.048553466796875,0.048553466796875,0.9986419677734375,303.55,164.25,0.9984130859375,-0.0528106689453125,0.0528106689453125,0.9984130859375,303.5,164.35,0.9981689453125,-0.057037353515625,0.057037353515625,0.9981689453125,303.5,164.35,0.997894287109375,-0.061279296875,0.061279296875,0.997894287109375,303.45,164.4,0.997650146484375,-0.0654754638671875,0.0654754638671875,0.997650146484375,303.35,164.45,0.99755859375,-0.0697479248046875,0.0697479248046875,0.99755859375,303.25,164.5 ],
        cam_body : [ 1,0,0,1,259.45,124.55],
    };



    var sceneWidth = 512;
    var sceneHeight = 512;
    var spritesheetWidth = 256;
    var spriteSheetHeight = 512;
    var materialPerso;
    var spritesheet;
    var rtMaterial, rtScene, ortho, rtt;

    var scale = 1;
    var jumelles, camera;
    function Animation(){

        Scene.call( this );

        for( var key in uvs )
        {
            var r = uvs[ key ];
            r.x /= 256;
            r.y /= 512;
            r.w /= 256;
            r.h /= 512;
        }

        rtScene = new THREE.Scene();
        ortho = new THREE.OrthographicCamera(-sceneWidth/2, sceneWidth/2,sceneHeight/2, -sceneHeight/2, 0,100);
        rtt = new THREE.WebGLRenderTarget(sceneWidth, sceneHeight );//, {transparent:true,format: THREE.RGBAFormat} );

        rtMaterial = materials.bitmap.clone();
        rtMaterial.transparent = true;
        rtMaterial.uniforms.texture.value = rtt;
        rtt.needsUpdate = true;
        this.add( new THREE.Mesh( new THREE.PlaneBufferGeometry(sceneWidth, sceneHeight), rtMaterial ) );

        //limbs texture
        this.limbs = [];
        var url = "src/3d/textures/animation/ref_perso.png";
        spritesheet = materials.bitmap.clone();
        textures.loadTexture( url, function(t)
        {
            spritesheet.uniforms.texture.value = t;
            t.minFilter = THREE.LinearFilter;
            t.magFilter = THREE.LinearFilter;
        });
        spritesheet.transparent = true;

        //jummelles
        jumelles = build( this, ["jum_body", "jum_avb", "jum_epa"] );

        camera = build( this, ["cam_body", "cam_epaule_gauche", "cam_epaule_droite", "cam_bras_droit", "cam_bras_gauche", "cam_camera"]);
        camera.visible = false;

    }

    function build( scope, array )
    {

        var group = new THREE.Group();
        array.forEach( function( key, i )
        {
            var size = sizes[key];
            var rect = uvs[ key ];
            //var geom = getPlaneBufferGeometry( rect.x / spritesheetWidth, rect.y / spriteSheetHeight, rect.w / spritesheetWidth, rect.h / spriteSheetHeight );
            var geom = getPlaneBufferGeometry( rect.x, rect.y, rect.w, rect.h );

            var m = new THREE.Mesh( geom, spritesheet );
            m.position.x += size[0] / 2;
            m.position.y -= size[1] / 2;
            m.scale.set( size[0], size[1], 1 );

            var g = new THREE.Group();
            g.name = key;
            g.add( m );

            //position
            g.position.x = frames[ key ][4] - sceneWidth / 2;
            g.position.y = sceneHeight / 2 - frames[ key ][5];
            g.position.z = -1 -i * 10;

            g.rotation.z = Math.atan2( frames[2], frames[3] );
            g.frames = frames[ key ];

            group.add( g );
            scope.limbs.push( g );

            g.renderOrder = array.length - i;
            if( key.lastIndexOf( "body" ) != -1 )
            {
                g.rotation.x = 0;
                g.renderOrder += 10;
            }
            i++;

        });
        rtScene.add( group );
        return group;
    }

    //TODO ajout appareil photo
    function setObjectType( type ){
        spritesheet.uniforms.brightness.value = brightness;
        materialPerso.uniforms.brightness.value = brightness;
    }

    function setBrightness( brightness ){
        spritesheet.uniforms.brightness.value = brightness;
        materialPerso.uniforms.brightness.value = brightness;
    }

    function flip( dir )
    {
        jumelles.visible = dir == 1;
        camera.visible = dir == -1;
    }

    function update( time, brightness )
    {
        time = time || this.time;

        for( var i = 0; i< this.limbs.length; i++ )
        {
            var l = this.limbs[i];
            var id = parseInt( parseInt( time * ( l.frames.length - 1 )  ) / 6 ) * 6;

            l.position.x = l.frames[id+4] * scale - sceneWidth / 2;
            l.position.y = sceneHeight/2 - l.frames[id+5] * scale;
            l.rotation.z = Math.atan2(l.frames[id+2], l.frames[id+3] );
        }

        stage3d.render( rtScene, ortho, rtt );
        rtMaterial.uniforms.texture.value = rtt;
        rtt.needsUpdate = true;

    }

    var _p = Animation.prototype = Object.create( Scene.prototype );
    _p.constructor = Animation;
    _p.setBrightness = setBrightness;
    _p.flip = flip;
    _p.update = update;
    return Animation;

}();